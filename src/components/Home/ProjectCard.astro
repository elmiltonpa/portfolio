---
import { cn } from "../../lib/utils";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import Modal from "../ui/Modal.astro";

import type { ImageMetadata } from "astro";

interface Props {
    title: string;
    description: string;
    tags?: string[];
    github?: string;
    link?: string;
    featured?: boolean;
    image?: ImageMetadata;
}

const { title, description, tags = [], github, link, image } = Astro.props;
const modalId = `modal-${title.replace(/\s+/g, "-").toLowerCase()}`;
---

<article
    class={cn(
        "group relative flex flex-col bg-secondary/30 rounded-3xl border border-white/5 overflow-hidden transition-all duration-500",
        "hover:border-primary/30 hover:bg-secondary/50 hover:-translate-y-1 shadow-2xl",
    )}
>
    {
        image && (
            <div class="relative w-full aspect-video overflow-hidden">
                <div class="absolute inset-0 bg-linear-to-t from-background/60 via-transparent to-transparent z-10 opacity-40" />
                <Image
                    src={image}
                    alt={title}
                    width={800}
                    format="webp"
                    class="w-full h-full object-cover object-top transition-transform duration-700 group-hover:scale-105"
                />

                <div class="absolute inset-0 z-20 flex items-center justify-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 backdrop-blur-xs bg-background/20">
                    {github && (
                        <a
                            href={github}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="p-3 rounded-full bg-background/80 text-foreground hover:bg-primary hover:text-primary-foreground transition-all transform translate-y-4 group-hover:translate-y-0 duration-300 shadow-xl"
                            aria-label="View code on GitHub"
                            title="View Code"
                        >
                            <Icon
                                name="lucide:github"
                                class="w-6 h-6"
                                aria-hidden="true"
                            />
                        </a>
                    )}
                    {link && (
                        <a
                            href={link}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="p-3 rounded-full bg-background/80 text-foreground hover:bg-primary hover:text-primary-foreground transition-all transform translate-y-4 group-hover:translate-y-0 duration-300 delay-75 shadow-xl"
                            aria-label="View live demo"
                            title="View Demo"
                        >
                            <Icon
                                name="lucide:external-link"
                                class="w-6 h-6"
                                aria-hidden="true"
                            />
                        </a>
                    )}
                </div>
            </div>
        )
    }

    <div class="project-card-content flex flex-col grow p-6 md:p-8">
        <div class="flex items-center gap-3 mb-3">
            <h3
                class="text-xl font-bold text-foreground group-hover:text-primary transition-colors"
            >
                {title}
            </h3>
            <div
                class="h-px grow bg-white/5 group-hover:bg-primary/20 transition-colors"
            >
            </div>
        </div>

        <div class="relative group/desc">
            <p
                class="text-muted-foreground text-sm md:text-base mb-4 line-clamp-3 leading-relaxed"
            >
                {description}
            </p>
            <button
                data-open-modal={modalId}
                class="text-sm font-mono text-primary/90 hover:text-primary hover:underline mb-6 cursor-pointer block transition-colors duration-200"
            >
                View full description â†’
            </button>
        </div>

        <div class="flex flex-wrap gap-2 mt-auto pt-4">
            {
                tags.map((tech) => (
                    <span class="text-xs font-mono font-semibold tracking-wider uppercase text-primary bg-primary/10 px-3 py-1.5 rounded-lg border border-primary/25 hover:bg-primary/15 hover:border-primary/40 hover:scale-105 transition-all duration-300 cursor-default">
                        {tech}
                    </span>
                ))
            }
        </div>
    </div>
</article>

<Modal id={modalId} title={title}>
    <div class="space-y-6">
        {
            image && (
                <Image
                    src={image}
                    alt={title}
                    width={800}
                    height={450}
                    format="webp"
                    class="w-full rounded-2xl border border-border"
                />
            )
        }
        <div class="space-y-4">
            <h4 class="text-lg font-bold text-foreground font-mono italic">
                About the project
            </h4>
            <p class="text-muted-foreground leading-relaxed">
                {description}
            </p>
        </div>

        <div class="flex flex-wrap gap-2 pt-4">
            {
                tags.map((tech) => (
                    <span class="text-xs font-mono font-semibold tracking-wider uppercase text-primary bg-primary/10 px-3 py-1.5 rounded-lg border border-primary/25">
                        {tech}
                    </span>
                ))
            }
        </div>

        <div class="flex gap-4 pt-6">
            {
                github && (
                    <a
                        href={github}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-secondary text-foreground hover:bg-primary hover:text-primary-foreground transition-all duration-300 border border-border"
                    >
                        <Icon name="lucide:github" class="size-5" />
                        <span class="font-mono text-sm">Code</span>
                    </a>
                )
            }
            {
                link && (
                    <a
                        href={link}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-primary text-primary-foreground hover:opacity-90 transition-all duration-300 shadow-lg shadow-primary/20"
                    >
                        <Icon name="lucide:external-link" class="size-5" />
                        <span class="font-mono text-sm">Live Demo</span>
                    </a>
                )
            }
        </div>
    </div>
</Modal>

<script>
    document.addEventListener("astro:page-load", () => {
        const openButtons = document.querySelectorAll("[data-open-modal]");

        openButtons.forEach((button) => {
            button.addEventListener("click", () => {
                const modalId = button.getAttribute("data-open-modal");
                if (modalId) {
                    const modal = document.getElementById(
                        modalId,
                    ) as HTMLDialogElement;
                    if (modal) {
                        modal.showModal();
                        document.body.style.overflow = "hidden";

                        modal.addEventListener(
                            "close",
                            () => {
                                document.body.style.overflow = "";
                            },
                            { once: true },
                        );
                    }
                }
            });
        });
    });
</script>

<style>
    .project-card-content {
        position: relative;
    }

    .project-card-content::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(var(--primary-rgb), 0.1) 20%,
            rgba(var(--primary-rgb), 0.8) 50%,
            rgba(var(--primary-rgb), 0.1) 80%,
            transparent
        );
        background-size: 200% 100%;
        animation: light-travel 5s linear infinite;
    }

    @keyframes light-travel {
        0% {
            background-position: 200% 0;
        }
        100% {
            background-position: -200% 0;
        }
    }
</style>
