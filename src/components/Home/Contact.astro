---
import Button from "../ui/Button.astro";
---

<section id="contact" class="bg-bg-transparent border-t border-border">
    <div class="section-container">
        <h2 class="section-title text-foreground">Contact</h2>

        <div class="grid lg:grid-cols-3 gap-16 items-start">
            <div class="lg:col-span-1 space-y-8">
                <p
                    class="text-2xl md:text-3xl font-bold text-foreground leading-tight"
                >
                    Do you have an idea in mind? <span
                        class="text-primary whitespace-nowrap">Let's talk.</span
                    >
                </p>

                <div class="space-y-4">
                    <p
                        class="text-sm font-mono text-muted-foreground uppercase tracking-widest"
                    >
                        Direct contact
                    </p>
                    <a
                        id="email-contact"
                        href="#"
                        class="text-lg md:text-xl text-foreground font-mono hover:text-primary transition-colors block underline decoration-primary/30 underline-offset-8"
                    >
                    </a>
                </div>
            </div>

            <div class="lg:col-span-2">
                <form
                    id="contact-form"
                    method="POST"
                    class="bg-background/70 border border-border/60 shadow-xl rounded-2xl p-10 space-y-6 text-left"
                >
                    <div class="grid sm:grid-cols-2 gap-5">
                        <!-- Honeypot field -->
                        <input
                            type="text"
                            name="_gotcha"
                            style="display:none"
                        />

                        <div class="relative group">
                            <input
                                type="text"
                                id="name"
                                name="name"
                                placeholder=" "
                                required
                                autocomplete="off"
                                class="peer w-full px-4 pt-6 pb-2 rounded-xl border border-border bg-card text-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 hover:border-primary/40 outline-none transition-all"
                            />
                            <label
                                for="name"
                                class="absolute left-4 top-4 text-muted-foreground/70 transition-all duration-200 pointer-events-none
                                peer-focus:-translate-y-3 peer-focus:text-xs peer-focus:text-primary
                                peer-[:not(:placeholder-shown)]:-translate-y-3 peer-[:not(:placeholder-shown)]:text-xs"
                            >
                                Name
                            </label>
                        </div>

                        <div class="relative group">
                            <input
                                type="email"
                                id="email"
                                name="email"
                                placeholder=" "
                                required
                                autocomplete="email"
                                class="peer w-full px-4 pt-6 pb-2 rounded-xl border border-border bg-card text-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 hover:border-primary/40 outline-none transition-all"
                            />
                            <label
                                for="email"
                                class="absolute left-4 top-4 text-muted-foreground/70 transition-all duration-200 pointer-events-none
                                        peer-focus:-translate-y-3 peer-focus:text-xs peer-focus:text-primary
                                        peer-[:not(:placeholder-shown)]:-translate-y-3 peer-[:not(:placeholder-shown)]:text-xs"
                            >
                                Email
                            </label>
                        </div>
                    </div>

                    <div class="relative group">
                        <input
                            type="text"
                            id="subject"
                            name="subject"
                            placeholder=" "
                            required
                            autocomplete="off"
                            class="peer w-full px-4 pt-6 pb-2 rounded-xl border border-border bg-card text-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 hover:border-primary/40 outline-none transition-all"
                        />
                        <label
                            for="subject"
                            class="absolute left-4 top-4 text-muted-foreground/70 transition-all duration-200 pointer-events-none
                            peer-focus:-translate-y-3 peer-focus:text-xs peer-focus:text-primary
                            peer-[:not(:placeholder-shown)]:-translate-y-3 peer-[:not(:placeholder-shown)]:text-xs"
                        >
                            Subject
                        </label>
                    </div>

                    <div class="relative group">
                        <textarea
                            id="message"
                            name="message"
                            rows="5"
                            placeholder=" "
                            required
                            class="peer w-full px-4 pt-8 pb-2 rounded-xl border border-border bg-card text-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 hover:border-primary/40 outline-none transition-all resize-none"
                        ></textarea>
                        <label
                            for="message"
                            class="absolute left-4 top-5 text-muted-foreground/70 transition-all duration-200 pointer-events-none
                            peer-focus:-translate-y-3 peer-focus:text-xs peer-focus:text-primary
                            peer-[:not(:placeholder-shown)]:-translate-y-3 peer-[:not(:placeholder-shown)]:text-xs"
                        >
                            Your message...
                        </label>
                    </div>

                    <div class="flex justify-end">
                        <Button
                            id="submit-button"
                            type="submit"
                            size="lg"
                            icon="lucide:send"
                            class="font-mono px-10"
                        >
                            Send message
                        </Button>
                    </div>
                    <p
                        id="form-status"
                        role="status"
                        aria-live="polite"
                        class="mt-4 text-center text-sm hidden"
                    >
                    </p>
                </form>
            </div>
        </div>
    </div>
</section>

<style>
    input:-webkit-autofill {
        -webkit-box-shadow: 0 0 0px 1000px var(--card) inset !important;
        -webkit-text-fill-color: var(--foreground) !important;
    }
</style>

<script>
    const emailLink = document.getElementById("email-contact");
    if (emailLink) {
        const u = "elmiltonibarra";
        const d = "gmail.com";
        const email = `${u}@${d}`;
        emailLink.setAttribute("href", `mailto:${email}`);
        emailLink.textContent = email;
    }

    const contactForm = document.getElementById("contact-form");
    const formStatus = document.getElementById("form-status");
    const submitBtn = document.getElementById("submit-button");

    if (contactForm && formStatus) {
        contactForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            formStatus.textContent = "Sending...";
            formStatus.classList.remove(
                "hidden",
                "text-red-500",
                "text-green-500",
            );
            formStatus.classList.add("text-foreground", "animate-pulse");

            if (submitBtn instanceof HTMLButtonElement) {
                submitBtn.disabled = true;
            }

            const formData = new FormData(contactForm as HTMLFormElement);

            const email = formData.get("email") as string;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!emailRegex.test(email)) {
                formStatus.textContent = "Please enter a valid email address.";
                formStatus.classList.remove(
                    "hidden",
                    "animate-pulse",
                    "text-foreground",
                );
                formStatus.classList.add("text-destructive");
                if (submitBtn instanceof HTMLButtonElement)
                    submitBtn.disabled = false;
                return;
            }

            try {
                const response = await fetch(
                    "https://formspree.io/f/xwvnbrod",
                    {
                        method: "POST",
                        body: formData,
                        headers: {
                            Accept: "application/json",
                        },
                    },
                );

                if (response.ok) {
                    formStatus.textContent =
                        "Thanks! Message sent successfully";
                    formStatus.classList.remove(
                        "animate-pulse",
                        "text-foreground",
                    );
                    formStatus.classList.add("text-primary");
                    (contactForm as HTMLFormElement).reset();
                } else {
                    const data = await response.json();
                    if (Object.hasOwn(data, "errors")) {
                        formStatus.textContent = data["errors"]
                            .map((error: any) => error.message)
                            .join(", ");
                    } else {
                        formStatus.textContent =
                            "Oops! There was a problem submitting your form";
                    }
                    throw new Error();
                }
            } catch (err) {
                formStatus.classList.remove("animate-pulse", "text-foreground");
                formStatus.classList.add("text-destructive");
                if (
                    !formStatus.textContent ||
                    formStatus.textContent === "Sending..."
                ) {
                    formStatus.textContent =
                        "Oops! There was a problem sending your message.";
                }
            } finally {
                if (submitBtn instanceof HTMLButtonElement) {
                    submitBtn.disabled = false;
                }
                setTimeout(() => {
                    formStatus.classList.add("hidden");
                }, 5000);
            }
        });
    }
</script>
